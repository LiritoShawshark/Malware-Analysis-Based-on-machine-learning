import pickle
import numpy as np
import os


def get_filelist(dir, list):                                               # 得到文件列表
    for home, dirs, files in os.walk(dir):
        for filename in files:
            fullname = os.path.join(home, filename)
            list.append([filename, fullname])


# 载入模型
f = open('rf.pickle', 'rb')
rf = pickle.load(f)
f.close()

# 获得testmal下所有文件名
dirs = []
get_filelist('testmal', dirs)
X = []

for dir in dirs:
    with open(dir[1], 'r') as f:
        while True:
            l = f.readline()
            if not l:
                break
            l = l.strip('\n')
            list = l.split()
            X.append(list[2:])                                 # 去除前两个数据，把剩余加入X

result = rf.predict(X)                                         # 预测模型
print(np.array([int(r) for r in result]))                      # 模型里是float，此处换回int，0是坏数据
sum0 = 0
for r in result:
    if int(r) == 0:
        sum0 += 1
ac = sum0 / len(result)
print('准确率：' + str(round(ac, 4)))


import os


def get_filelist(dir, list):                                               # 得到文件列表
    for home, dirs, files in os.walk(dir):
        for filename in files:
            fullname = os.path.join(home, filename)
            list.append([filename, fullname])


if __name__ == "__main__":
    file_list_good, file_list_bad = [], []                                 # 未处理的源数据
    get_filelist('normal', file_list_good)
    get_filelist('mal', file_list_bad)

    fn = open('net_data1', mode='w')                                       # 保存训练数据

    for file in file_list_good:
        write_data = []                                                    # 读取该文件中所有行数据
        with open(file[1], 'r') as f:
            while True:
                l = f.readline()
                if not l:
                    break
                l = l.strip('\n')
                list = l.split()
                write_data.append(list[2:])                                # 前两个数据为端口，此处去掉
        check = []
        for i in range(len(write_data)):                                   # 去除多余数据
            if i in check:
                continue
            for j in range(i+1, len(write_data)):
                if write_data[i][:9] == write_data[j][:9]:                 # 如果前九项数据相同，则认为数据冗余，去除
                    check.append(j)
        for i in range(len(write_data)):                                   # 写入数据
            if i not in check:
                for n in write_data[i]:
                    fn.write(str(n)+',')
                fn.write('1\n')                                            # 好数据记为1

    for file in file_list_bad:
        write_data = []
        with open(file[1], 'r') as f:
            while True:
                l = f.readline()
                if not l:
                    break
                l = l.strip('\n')
                list = l.split()
                write_data.append(list[2:])
        check = []
        for i in range(len(write_data)):
            if i in check:
                continue
            for j in range(i+1, len(write_data)):
                if write_data[i][:9] == write_data[j][:9]:
                    check.append(j)
        for i in range(len(write_data)):
            if i not in check:
                for n in write_data[i]:
                    fn.write(str(n)+',')
                fn.write('0\n')                                            # 坏数据记为0

    fn.close()
